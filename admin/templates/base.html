<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
</head>
<body>
<nav class="navbar is-light">
    <div class="navbar-brand">
        <a class="navbar-item" href="/admin">Roundtable AI</a>
    </div>
    <div class="navbar-menu">
        <div class="navbar-start">
            <a class="navbar-item" href="/admin/providers">Провайдеры</a>
            <a class="navbar-item" href="/admin/personalities">Персоналии</a>
            <a class="navbar-item" href="/admin/sessions">Сессии</a>
            <a class="navbar-item" href="/admin/settings">Настройки</a>
        </div>
    </div>
</nav>
<section class="section">
    <div class="container">
        {% block content %}{% endblock %}
    </div>
</section>
<script>
document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('form[data-method]').forEach((form) => {
        form.addEventListener('submit', async (event) => {
            event.preventDefault();
            const method = (form.dataset.method || 'post').toUpperCase();
            const action = form.getAttribute('action');
            const redirectUrl = form.dataset.redirect || window.location.pathname;
            const formData = new FormData(form);
            const response = await fetch(action, {
                method,
                body: formData,
            });
            if (response.ok) {
                if (response.redirected) {
                    window.location.href = response.url;
                } else {
                    window.location.href = redirectUrl;
                }
            } else {
                const text = await response.text();
                alert(`Ошибка ${response.status}: ${text}`);
            }
        });
    });

    document.querySelectorAll('[data-delete]').forEach((element) => {
        element.addEventListener('click', async (event) => {
            event.preventDefault();
            if (!confirm('Удалить запись?')) {
                return;
            }
            const url = element.dataset.delete;
            const redirectUrl = element.dataset.redirect || window.location.pathname;
            const response = await fetch(url, { method: 'DELETE' });
            if (response.ok) {
                if (response.redirected) {
                    window.location.href = response.url;
                } else {
                    window.location.href = redirectUrl;
                }
            } else {
                const text = await response.text();
                alert(`Ошибка ${response.status}: ${text}`);
            }
        });
    });
});
</script>
</body>
</html>
